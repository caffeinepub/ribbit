{
  "kind": "implementation_plan",
  "version": "1.0",
  "title": "Step 3 (frontend): Pass phrase-hash userId into phrase-hash-enabled React Query hooks",
  "requirements": [
    {
      "id": "REQ-5",
      "summary": "Update React Query hooks/mutations to pass computed phrase-hash userId into backend methods that accept it, with empty-string fallback to legacy calls.",
      "acceptanceCriteria": [
        "In frontend/src/hooks/useQueries.ts, mutations such as join/leave pond, create post/lily, create ribbit, like/unlike post, like/unlike ribbit, and username-related mutations pass the computed userId to the backend method when the backend signature expects it.",
        "If getPhraseHashUserId() returns an empty string, the frontend still calls the backend in a way that preserves existing anonymous/Principal-based behavior (no crashes).",
        "TypeScript builds cleanly after regenerating backend bindings (no mismatched parameter lists)."
      ],
      "file_operations": [
        {
          "path": "frontend/src/hooks/useQueries.ts",
          "operation": "modify",
          "description": "Update phrase-hash-aware queries/mutations to actually use getPhraseHashUserId() when calling backend functions that accept a userId. Specifically: (1) join/leave pond should call joinPondByPhraseHash(userId, pondName) / leavePondByPhraseHash(userId, pondName) when userId !== \"\", otherwise call joinPond(pondName) / leavePond(pondName); (2) username availability and can-change checks should call isUsernameAvailableByPhraseHash(userId, username) and canChangeUsernameByPhraseHash(userId, username) when userId !== \"\", otherwise call isUsernameAvailable(username) and canChangeUsername(username); (3) username mutations should call registerUsernameWithPhraseHash(userId, username), releaseUsernameWithPhraseHash(userId, username), and recordUsernameChangeByPhraseHash(userId, username) when userId !== \"\", otherwise use the existing Principal/legacy variants; (4) user profile save should call saveUserProfileByPhraseHash(userId, profile) when userId !== \"\", otherwise use saveCallerUserProfile(profile). Additionally, after backend bindings are regenerated, update any identity-affecting mutations whose signatures have been expanded to accept userId (e.g., create post/lily, create ribbit, like/unlike post, like/unlike ribbit) so they pass userId when required, while preserving empty-string fallback behavior."
        }
      ]
    }
  ]
}