{
  "kind": "implementation_plan",
  "version": "1.0",
  "title": "Update frontend pond membership flows to be Froggy Phrase hash (userId) based",
  "requirements": [
    {
      "id": "REQ-6",
      "summary": "Switch frontend pond membership queries/mutations to phrase-hash (userId) methods only and ensure join/leave refreshes membership UI immediately.",
      "acceptanceCriteria": [
        "Frontend membership actions (join/leave) call phrase-hash membership methods (e.g., `joinPondByPhraseHash(userId, pondName)` / `leavePondByPhraseHash(userId, pondName)`) and no longer rely on `joinPond(pondName)` / `leavePond(pondName)` for the anonymous-site flow.",
        "The joined-ponds query used by the UI is fetched by phrase hash (userId) so that joined ponds are scoped to the current Froggy Phrase identity.",
        "After join/leave, the frontend invalidates and refetches the pond + joined-ponds queries and the UI immediately reflects the correct membership state for that userId."
      ],
      "file_operations": [
        {
          "path": "frontend/src/backend.d.ts",
          "operation": "modify",
          "description": "Update the typed backend interface to match the new phrase-hash-based membership read capability used by the UI (e.g., add a `getJoinedPondsByPhraseHash(userId: string): Promise<Array<string>>` method, and any other phrase-hash membership status reads the frontend will call)."
        },
        {
          "path": "frontend/src/hooks/useQueries.ts",
          "operation": "modify",
          "description": "Remove principal-based fallback behavior for pond membership flows: update `useJoinPond` and `useLeavePond` to always compute `userId` via `getPhraseHashUserId()` and call only `actor.joinPondByPhraseHash(userId, pondName)` / `actor.leavePondByPhraseHash(userId, pondName)` (if `userId` cannot be computed, throw a clear error instead of falling back). Update `useGetJoinedPonds` to fetch joined ponds using a phrase-hash method (e.g., `actor.getJoinedPondsByPhraseHash(userId)`) rather than `actor.getJoinedPonds()`. Ensure post-mutation invalidations include `['joinedPonds']` and both pond detail keys used by the UI (e.g., `['pond', pondName]` and `['pondAbout', pondName]`) so pond pages/cards/about sidebar update immediately."
        }
      ]
    }
  ]
}