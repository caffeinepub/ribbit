{
  "kind": "build_request",
  "title": "Auto-join pond creator on pond creation and fix memberCount mismatch",
  "priority": "normal",
  "requirements": [
    {
      "id": "REQ-12",
      "text": "Fix the backend pond creation flow so that the pond creator is automatically added to the new pond’s `members : [Text]` (phrase-hash userId list) at creation time, and ensure `memberCount` accurately reflects actual membership (i.e., do not preset/increment `memberCount` without persisting the creator in `members`).",
      "target": "backend",
      "source": {
        "messageIds": [
          "msg-6",
          "msg-8"
        ],
        "quotes": [
          "pond creators are still not automatically not joining their ponds. however, when a pond is created it says there is already 1 member that is joined. why?",
          "ok then fix it"
        ]
      },
      "acceptanceCriteria": [
        "When a pond is created, the returned/stored pond record has `members` containing the creator’s phrase-hash userId.",
        "Immediately after creation, the pond’s `memberCount` equals the length of `members` (and is consistent with the creator being included).",
        "A newly created pond no longer shows 1 member unless the creator is actually in `members`."
      ]
    },
    {
      "id": "REQ-13",
      "text": "When a pond is created, update (or create if missing) the creator’s phrase-hash `UserProfile` so `joinedPonds` contains the newly created pond name immediately after creation (no separate join action required).",
      "target": "backend",
      "source": {
        "messageIds": [
          "msg-7",
          "msg-8"
        ],
        "quotes": [
          "The fix is simply: when creating the pond, push the creator’s userId into pond.members and update their profile’s joinedPonds at the same time.",
          "ok then fix it"
        ]
      },
      "acceptanceCriteria": [
        "Immediately after pond creation, `getUserProfileByPhraseHash(creatorUserId)` returns a profile whose `joinedPonds` includes the new pond name exactly once.",
        "The frontend’s existing query invalidations in `useCreatePond()` (e.g., `['currentUserProfile']`, `['joinedPonds']`) result in the UI reflecting membership without requiring a manual refresh."
      ]
    }
  ],
  "constraints": [
    "Backend must remain a single Motoko actor in backend/main.mo (no additional backend services).",
    "Do not edit frontend files under the immutable paths listed in SYSTEM_CONTEXT (compose existing UI components instead).",
    "Use English for any user-facing text."
  ],
  "nonGoals": [
    "Do not implement a one-off migration/repair job to retroactively fix membership for ponds created before this change unless explicitly requested.",
    "Do not change unrelated AccessControl behavior beyond what is necessary for pond-creator auto-join.",
    "Do not redesign the pond creation UI or add new product features."
  ],
  "imageRequirements": {
    "required": [],
    "edits": []
  },
  "userProfileUpdate": {
    "goalsToAdd": [],
    "goalsToRemove": [],
    "preferencesToAdd": [],
    "preferencesToRemove": [],
    "miscToAdd": [],
    "miscToRemove": [],
    "fieldsToSet": {},
    "fieldsToDelete": []
  }
}