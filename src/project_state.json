{
  "schemaVersion": "1.0.0",
  "projectStateVersion": 3,
  "summary": "Implement/fix authorization so Froggy Phrase users are recognized as full users for actions even when the caller principal is anonymous, eliminating persistent \"unauthorized\" errors.",
  "architectural_notes": [
    "Authorization should accept a valid Froggy Phrase userID/hash as sufficient for role '#user' across all actions, bypassing principal-based checks when present."
  ],
  "known_issues": [
    "Users still receive 'unauthorized' for actions (create ponds/lilies, save avatars, etc.) because backend sees anonymous principal instead of Froggy Phrase identity; requires auth guard update."
  ],
  "isFixRequest": true,
  "existing_features": [
    {
      "id": "feature-frontend-update-react-query-mutations-queries-to-consistently-use-phrase-hash-backend-endpoints-whenever-getphrasehashuserid-returns-a-non-empty-userid-including-at-minimum-create-pond-create-lily-post-create-ribbit-comment-like-unlike-actions-view-count-increments-and-avatar-profile-saving-so-froggy-phrase-users-do-not-hit-unauthorized-errors-when-not-using-internet-identity",
      "title": "Frontend: Update React Query mutations/queries to consistently use phrase-hash backend endpoints whenever `getPhraseHashUserId()` returns a non-empty userId, including (at minimum) create pond, create lily/post, create ribbit/comment, like/unlike actions, view-count increments, and avatar/profile saving, so Froggy Phrase users do not hit unauthorized errors when not using Internet Identity.",
      "reqIds": [
        "REQ-3"
      ],
      "version": 1
    }
  ],
  "new_feature_requests": [
    {
      "id": "AR-1",
      "summary": "Update authorization guard logic to treat any valid stored Froggy Phrase userID/hash as a full #user for all actions, regardless of principal (fix unauthorized errors on creating ponds/lilies, saving avatars, etc.)",
      "reqIds": [],
      "status": "in_progress"
    },
    {
      "id": "AR-2",
      "summary": "Backend: Implement Froggy Phraseâ€“based authorization so any call that includes a valid stored Froggy Phrase phrase-hash userId is authorized as a full `#user` regardless of the caller principal (including anonymous `2vxsx-fae`). This must eliminate current `Debug.trap(\"Unauthorized...\")` failures for Froggy Phrase users performing write actions.",
      "reqIds": [
        "REQ-1"
      ],
      "status": "pending"
    },
    {
      "id": "AR-3",
      "summary": "Backend: Add/extend phrase-hash variants for all user write actions that currently rely on `getUserRoleText(caller) == #user` (e.g., creating ponds, creating lilies/posts, creating ribbits/comments, liking/unliking, view-count increments, username/avatar/profile saves, and any other mutations triggered from the UI) so the frontend can pass the Froggy Phrase phrase-hash userId and succeed even when the actor is anonymous.",
      "reqIds": [
        "REQ-2"
      ],
      "status": "pending"
    }
  ],
  "projectName": "Froggy Phrase",
  "clarification_mode": "instant",
  "clarification_rounds": 0
}